<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenAce Phone</title>
    <style>
        body { /* Updated path and fixed background property */
            background: url("../../../ui/components/home/acepaper.png") no-repeat center center fixed;
            background-size: cover;
            min-height: 100vh;
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }

        .lq-glass {
            /* Frame 1 */

box-sizing: border-box;

/* Auto layout */
display: flex;
flex-direction: row;
justify-content: center;
align-items: center;
padding: 14px 20px;
gap: 10px;

position: absolute;
width: 50px;
height: 50px;
left: 138px;
top: 559px;

background: rgba(255, 255, 255, 0.02);
box-shadow: inset 0px -2px 4px rgba(0, 0, 0, 0.2), inset 0px 2px 4px rgba(255, 255, 255, 0.4);
backdrop-filter: blur(5px);
/* Note: backdrop-filter has minimal browser support */
border-radius: 10px;

        }

        .glass {
            background: rgba(255, 255, 255, 0.12);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.15);
        }
        .content-section { display: none; }
        .content-section.active { display: block; }
        /* Custom scrollbar for webkit browsers */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
        }
        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }
    </style>
    <script src="https://cdn.tailwindcss.com"></script> <!-- Moved Tailwind script after custom styles potentially -->
</head>
<body class="flex flex-col items-center justify-center min-h-screen p-4 md:p-8"> 
    <div class="glass rounded-3xl shadow-lg w-full max-w-md md:max-w-full p-4 md:p-6 flex flex-col" style="height: 85vh; max-height: 800px; overflow-y: auto;">
        <h1 class="text-3xl font-bold text-center mb-6 text-white">Phone</h1> <!-- Reverted to text-white for consistency with glass theme -->
        <nav class="flex justify-around mb-6 md:hidden">
            <button class="glass rounded-full shadow-lg p-3 w-16 h-16 flex items-center justify-center" onclick="showSection('dialpad')"><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#FFFFFF"><path d="M480-40q-33 0-56.5-23.5T400-120q0-33 23.5-56.5T480-200q33 0 56.5 23.5T560-120q0 33-23.5 56.5T480-40ZM240-760q-33 0-56.5-23.5T160-840q0-33 23.5-56.5T240-920q33 0 56.5 23.5T320-840q0 33-23.5 56.5T240-760Zm0 240q-33 0-56.5-23.5T160-600q0-33 23.5-56.5T240-680q33 0 56.5 23.5T320-600q0 33-23.5 56.5T240-520Zm0 240q-33 0-56.5-23.5T160-360q0-33 23.5-56.5T240-440q33 0 56.5 23.5T320-360q0 33-23.5 56.5T240-280Zm480-480q-33 0-56.5-23.5T640-840q0-33 23.5-56.5T720-920q33 0 56.5 23.5T800-840q0 33-23.5 56.5T720-760ZM480-280q-33 0-56.5-23.5T400-360q0-33 23.5-56.5T480-440q33 0 56.5 23.5T560-360q0 33-23.5 56.5T480-280Zm240 0q-33 0-56.5-23.5T640-360q0-33 23.5-56.5T720-440q33 0 56.5 23.5T800-360q0 33-23.5 56.5T720-280Zm0-240q-33 0-56.5-23.5T640-600q0-33 23.5-56.5T720-680q33 0 56.5 23.5T800-600q0 33-23.5 56.5T720-520Zm-240 0q-33 0-56.5-23.5T400-600q0-33 23.5-56.5T480-680q33 0 56.5 23.5T560-600q0 33-23.5 56.5T480-520Zm0-240q-33 0-56.5-23.5T400-840q0-33 23.5-56.5T480-920q33 0 56.5 23.5T560-840q0 33-23.5 56.5T480-760Z"/></svg></button>
            <button class="glass rounded-full shadow-lg p-3 w-16 h-16 flex items-center justify-center" onclick="showSection('contacts')"><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#FFFFFF"><path d="M480-440q50 0 85-35t35-85q0-50-35-85t-85-35q-50 0-85 35t-35 85q0 50 35 85t85 35ZM160-160q-33 0-56.5-23.5T80-240v-480q0-33 23.5-56.5T160-800h640q33 0 56.5 23.5T880-720v480q0 33-23.5 56.5T800-160H160Zm70-80h500q-45-56-109-88t-141-32q-77 0-141 32t-109 88ZM200-40q-17 0-28.5-11.5T160-80q0-17 11.5-28.5T200-120h560q17 0 28.5 11.5T800-80q0 17-11.5 28.5T760-40H200Zm0-800q-17 0-28.5-11.5T160-880q0-17 11.5-28.5T200-920h560q17 0 28.5 11.5T800-880q0 17-11.5 28.5T760-840H200Z"/></svg></button>
            <button class="glass rounded-full shadow-lg p-3 w-16 h-16 flex items-center justify-center" onclick="showSection('history')"><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#FFFFFF"><path d="M240-80q-50 0-85-35t-35-85v-80q0-17 11.5-28.5T160-320h80v-536q0-7 6-9.5t11 2.5l29 29q6 6 14 6t14-6l32-32q6-6 14-6t14 6l32 32q6 6 14 6t14-6l32-32q6-6 14-6t14 6l32 32q6 6 14 6t14-6l32-32q6-6 14-6t14 6l32 32q6 6 14 6t14-6l32-32q6-6 14-6t14 6l32 32q6 6 14 6t14-6l29-29q5-5 11-2.5t6 9.5v656q0 50-35 85t-85 35H240Zm480-80q17 0 28.5-11.5T760-200v-560H320v440h320q17 0 28.5 11.5T680-280v80q0 17 11.5 28.5T720-160ZM400-680h160q17 0 28.5 11.5T600-640q0 17-11.5 28.5T560-600H400q-17 0-28.5-11.5T360-640q0-17 11.5-28.5T400-680Zm0 120h160q17 0 28.5 11.5T600-520q0 17-11.5 28.5T560-480H400q-17 0-28.5-11.5T360-520q0-17 11.5-28.5T400-560Zm280-40q-17 0-28.5-11.5T640-640q0-17 11.5-28.5T680-680q17 0 28.5 11.5T720-640q0 17-11.5 28.5T680-600Zm0 120q-17 0-28.5-11.5T640-520q0-17 11.5-28.5T680-560q17 0 28.5 11.5T720-520q0 17-11.5 28.5T680-480Z"/></svg></button>
        </nav>

        <!-- Main content wrapper: handles mobile overflow and becomes 3-column flex container on tablet -->
        <div class="flex-1 overflow-y-auto md:flex md:space-x-4 text-white">
            
            <!-- Column 1: Dialer (Visible on mobile if active, always visible in its column on tablet) -->
            <div id="dialpad" class="content-section active md:!flex md:flex-col md:w-1/3 md:h-full md:p-2 flex flex-col items-center">
                <h2 class="text-2xl font-semibold mb-4 text-white text-center">Dialer</h2>
                <input type="text" id="dialedNumber" class="glass w-full md:w-auto text-white text-2xl p-3 rounded-full mb-4 text-center shadow-lg" readonly>
                <div class="grid grid-cols-3 gap-3 w-full max-w-xs">
                    <button class="glass text-white text-xl rounded-full aspect-square shadow-lg" onclick="appendToDialer('1')">1</button>
                    <button class="glass text-white text-xl rounded-full aspect-square shadow-lg" onclick="appendToDialer('2')">2</button>
                    <button class="glass text-white text-xl rounded-full aspect-square shadow-lg" onclick="appendToDialer('3')">3</button>
                    <button class="glass text-white text-xl rounded-full aspect-square shadow-lg" onclick="appendToDialer('4')">4</button>
                    <button class="glass text-white text-xl rounded-full aspect-square shadow-lg" onclick="appendToDialer('5')">5</button>
                    <button class="glass text-white text-xl rounded-full aspect-square shadow-lg" onclick="appendToDialer('6')">6</button>
                    <button class="glass text-white text-xl rounded-full aspect-square shadow-lg" onclick="appendToDialer('7')">7</button>
                    <button class="glass text-white text-xl rounded-full aspect-square shadow-lg" onclick="appendToDialer('8')">8</button>
                    <button class="glass text-white text-xl rounded-full aspect-square shadow-lg" onclick="appendToDialer('9')">9</button>
                    <button class="glass text-white text-xl rounded-full aspect-square shadow-lg" onclick="appendToDialer('*')">*</button>
                    <button class="glass text-white text-xl rounded-full aspect-square shadow-lg" onclick="appendToDialer('0')">0</button>
                    <button class="glass text-white text-xl rounded-full aspect-square shadow-lg" onclick="appendToDialer('#')">#</button>
                </div>
                <div class="flex justify-around w-full max-w-xs mt-4">
                    <button class="glass px-6 py-3 rounded-full text-white font-semibold shadow-lg hover:bg-white/20" onclick="makeCall()">Call</button>
                    <button class="glass px-6 py-3 rounded-full text-white font-semibold shadow-lg hover:bg-white/20" onclick="clearDialer()">Clear</button>
                </div>
            </div>

            <!-- Column 2: Contacts (Visible on mobile if active, always visible in its column on tablet) -->
            <div id="contacts" class="content-section md:!flex md:flex-col md:w-1/3 md:h-full md:p-2 md:overflow-y-auto">
                <h2 class="text-2xl font-semibold mb-4 text-center text-white">Contacts</h2>
                
                <!-- Search Bar -->
                <div class="mb-4">
                    <input type="search" id="searchContactsInput" placeholder="Search contacts..." class="glass w-full text-white placeholder-white/60 p-2 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none shadow-lg">
                </div>

                <!-- Add New Contact Section -->
                <div class="glass mb-6 p-4 rounded-lg shadow-lg text-white">
                    <h3 class="text-lg font-medium mb-3 text-white text-center">Add New Contact</h3>
                    <input type="text" id="newContactName" placeholder="Name" class="glass w-full text-white placeholder-white/60 p-2 rounded-lg mb-2 focus:ring-2 focus:ring-blue-500 outline-none shadow-sm">
                    <input type="tel" id="newContactPhone" placeholder="Phone Number" class="glass w-full text-white placeholder-white/60 p-2 rounded-lg mb-2 focus:ring-2 focus:ring-blue-500 outline-none shadow-sm">
                    <button class="glass w-full px-4 py-2 mt-2 rounded-lg text-white font-semibold shadow-lg hover:bg-white/20" onclick="addContact()">Add Contact</button>
                </div>

                <!-- Contacts List -->
                <ul id="contactsList" class="space-y-2 text-white flex-1 overflow-y-auto"> <!-- flex-1 and overflow-y-auto for scrolling within column -->
                    <li class="glass p-3 rounded-lg text-center shadow-md">Loading contacts...</li>
                </ul>
            </div>

            <!-- Column 3: Call History (Visible on mobile if active, always visible in its column on tablet) -->
            <div id="history" class="content-section md:!flex md:flex-col md:w-1/3 md:h-full md:p-2 md:overflow-y-auto">
                <h2 class="text-2xl font-semibold mb-4 text-center text-white">Call History</h2>
                <ul id="callHistoryList" class="space-y-2 text-white flex-1 overflow-y-auto"> <!-- flex-1 and overflow-y-auto for scrolling within column -->
                    <li class="glass p-3 rounded-lg text-center shadow-md">Loading call history...</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        function showSection(sectionId) {
            const isMobile = window.innerWidth < 768; // Tailwind 'md' breakpoint (typically 768px)

            if (isMobile) {
                document.querySelectorAll('.content-section').forEach(section => {
                    section.classList.remove('active');
                });
                document.getElementById(sectionId).classList.add('active');
            } else {
                // On tablet, all sections are visible due to Tailwind classes.
                // This function could be used to "focus" a section if needed (e.g., scroll into view)
                // but not for hiding/showing. For now, it does nothing for display on tablet.
            }

            // Load data if the section is now "active" (on mobile) or generally needs it (on tablet, it's always "active" in terms of visibility)
            // For simplicity, we'll ensure data is loaded if the section is targeted.
            // More sophisticated logic could check if data is already loaded.
            if (sectionId === 'contacts') {
                loadContacts();
            }
            if (sectionId === 'history') {
                loadCallHistory();
            }
        }
        function appendToDialer(char) {
            document.getElementById('dialedNumber').value += char;
        }

        function clearDialer() {
            document.getElementById('dialedNumber').value = '';
        }

        function makeCall() {
            const number = document.getElementById('dialedNumber').value;
            if (number) {
                alert('Calling ' + number + '... (Not implemented yet)');
                // TODO: Implement actual call functionality via API
            } else {
                alert('Please enter a number to call.');
            }
        }

        async function loadContacts() {
            const listElement = document.getElementById('contactsList');
            listElement.innerHTML = '<li class="glass text-white p-3 rounded-lg text-center shadow-md">Loading contacts...</li>';
            try {
                const response = await fetch('/api/contacts');
                if (!response.ok) throw new Error('Failed to fetch contacts');
                const contacts = await response.json();
                listElement.innerHTML = ''; // Clear loading message
                if (contacts.length === 0) {
                    listElement.innerHTML = '<li class="glass text-white p-3 rounded-lg text-center shadow-md">No contacts found.</li>';
                } else {
                    contacts.forEach(contact => { // Each contact item will be styled by Tailwind if needed, but default li is fine for now
                        const li = document.createElement('li'); li.className = 'glass text-white p-3 rounded-lg shadow-md flex justify-between items-center';
                        li.textContent = `${contact.name} - ${contact.phoneNumber}`;
                        listElement.appendChild(li);
                    });
                }
            } catch (error) {
                console.error('Error loading contacts:', error);
                listElement.innerHTML = '<li class="glass text-white bg-red-500/30 p-3 rounded-lg text-center shadow-md">Error loading contacts.</li>';
            }
        }

        async function addContact() {
            const name = document.getElementById('newContactName').value;
            const phone = document.getElementById('newContactPhone').value;
            if (!name || !phone) {
                alert('Please enter both name and phone number.');
                return;
            }
            try {
                const response = await fetch('/api/contacts', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name: name, phoneNumber: phone })
                });
                if (!response.ok) {
                     const errorData = await response.json();
                     throw new Error(errorData.message || 'Failed to add contact');
                }
                const result = await response.json();
                alert(result.message || 'Contact added!');
                document.getElementById('newContactName').value = '';
                document.getElementById('newContactPhone').value = '';
                loadContacts(); // Refresh list
            } catch (error) {
                console.error('Error adding contact:', error);
                alert('Error adding contact: ' + error.message);
            }
        }


        async function loadCallHistory() {
            const listElement = document.getElementById('callHistoryList');
            listElement.innerHTML = '<li class="glass text-white p-3 rounded-lg text-center shadow-md">Loading call history...</li>';
            try {
                const response = await fetch('/api/callhistory');
                if (!response.ok) throw new Error('Failed to fetch call history');
                const history = await response.json();
                listElement.innerHTML = ''; // Clear loading message
                if (history.length === 0) {
                    listElement.innerHTML = '<li class="glass text-white p-3 rounded-lg text-center shadow-md">No call history.</li>';
                } else {
                    history.forEach(record => { // Each history item
                        const li = document.createElement('li'); li.className = 'glass text-white p-3 rounded-lg shadow-md';
                        li.textContent = `${record.contactName} (${record.type}) - ${record.timestamp}`;
                        listElement.appendChild(li);
                    });
                }
            } catch (error) {
                console.error('Error loading call history:', error);
                listElement.innerHTML = '<li class="glass text-white bg-red-500/30 p-3 rounded-lg text-center shadow-md">Error loading call history.</li>';
            }
        }

        // Initial load for the default active section
        document.addEventListener('DOMContentLoaded', () => {
            // Load data for all sections that might be visible
            loadContacts();
            loadCallHistory();

            const isMobile = window.innerWidth < 768;
            if (isMobile) {
                showSection('dialpad'); // Set default active section for mobile
            } else {
                // On tablet, all sections are made visible by Tailwind classes.
                // The 'active' class on #dialpad in HTML handles its default state.
                // We can remove 'active' from other sections if they were somehow set.
                document.getElementById('contacts').classList.remove('active');
                document.getElementById('history').classList.remove('active');
            }
        });
    </script>
</body>
</html>